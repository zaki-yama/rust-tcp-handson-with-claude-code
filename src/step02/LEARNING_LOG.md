# Step 2 Learning Log

## `#[repr(C, packed)]` について

### 質問内容

#[repr(C, packed)]とはなんですか？これはなぜ必要なんですか？

### 回答

#### 定義
- **`#[repr(C)]`**: 構造体のメモリレイアウトをC言語と同じにする
- **`packed`**: フィールド間のアライメント用の空白バイトを削除

#### 必要性
1. **ネットワークプロトコルの要求**: TCPヘッダーは厳密に20バイトと定義
2. **バイナリデータとの一致**: 受信バイト列と構造体レイアウトが完全一致する必要
3. **メモリ効率**: パディングなしで正確なサイズを実現

#### 例：通常 vs packed
```rust
// 通常の構造体 (アライメント付き)
struct Normal {
    a: u16,  // 2バイト + 2バイト padding
    b: u32,  // 4バイト
    // 合計: 8バイト
}

// packed構造体  
#[repr(C, packed)]
struct Packed {
    a: u16,  // 2バイト
    b: u32,  // 4バイト (パディングなし)
    // 合計: 6バイト
}
```

#### デメリット
1. **パフォーマンス**: 非アライメントアクセスは遅い
2. **安全性**: 参照作成時にUB (Undefined Behavior) のリスク  
3. **テストの複雑さ**: 直接フィールドアクセスができない
