# TCP実装カリキュラム詳細

## Phase 1: 基礎編

### Step 1: 基本的なソケット通信
**目標**: Raw socketを使った基本的なパケット送受信

**学習内容**:
- Raw socketの作成と使用方法
- IPヘッダーの構造理解
- パケットの送受信基礎

**実装内容**:
- Raw socketの初期化
- IPパケットの作成・送信
- パケット受信とログ出力

**RFC参照**: RFC 793 - Section 2.1 (基本概念)

**成果物**:
- 基本的なパケット送受信プログラム
- IP層での通信確認

**テスト**:
- localhost間でのパケット送受信
- Wiresharkでのパケット確認

---

### Step 2: TCPヘッダーの解析
**目標**: TCPヘッダーの構造を理解し、パース機能を実装

**学習内容**:
- TCPヘッダーの各フィールド
- バイトオーダー（エンディアン）
- チェックサム計算

**実装内容**:
- TCPヘッダー構造体定義
- ヘッダーパース機能
- チェックサム計算・検証
- ヘッダー生成機能

**RFC参照**: RFC 793 - Section 3.1 (Header Format)

**成果物**:
- `TcpHeader`構造体
- パース・シリアライズ機能
- チェックサム計算ライブラリ

**テスト**:
- 既知のTCPパケットのパース
- ヘッダー生成・検証
- チェックサム計算テスト

---

### Step 3: 3-way handshake の実装
**目標**: TCP接続確立の基本プロセスを実装

**学習内容**:
- SYN, SYN-ACK, ACKフラグの意味
- シーケンス番号の初期化
- 接続確立プロセス

**実装内容**:
- SYNパケット送信
- SYN-ACKパケット受信・処理
- ACKパケット送信
- 基本的な状態管理

**RFC参照**: RFC 793 - Section 3.4 (Establishing a connection)

**成果物**:
- 3-way handshake実装
- 基本的な接続状態追跡

**テスト**:
- ローカルサーバーとの接続確立
- Wiresharkでhandshake確認
- 状態変化の検証

---

## Phase 2: 接続管理編

### Step 4: 接続状態管理（TCP State Machine）
**目標**: TCP状態マシンの完全な実装

**学習内容**:
- TCP状態の種類と遷移
- 状態マシンの設計パターン
- イベント駆動型処理

**実装内容**:
- `TcpState`列挙型定義
- 状態遷移ロジック
- イベント処理システム
- 状態遷移図の実装

**RFC参照**: RFC 793 - Section 3.2, Figure 6 (State Diagram)

**成果物**:
- 完全な状態マシン実装
- 状態遷移テーブル
- デバッグ用状態表示

**テスト**:
- 各状態遷移の単体テスト
- 不正遷移の検出テスト
- 状態表示機能テスト

---

### Step 5: データ送受信とシーケンス番号
**目標**: TCPの基本的なデータ転送機能

**学習内容**:
- シーケンス番号の管理
- セグメント化とデータ分割
- 送信・受信バッファ

**実装内容**:
- 送信バッファ実装
- 受信バッファ実装
- シーケンス番号管理
- セグメント分割ロジック

**RFC参照**: RFC 793 - Section 3.3 (Sequence Numbers)

**成果物**:
- データ送受信機能
- バッファ管理システム
- シーケンス番号追跡

**テスト**:
- 小サイズデータ送受信
- セグメント分割テスト
- バッファ境界テスト

---

### Step 6: ACK処理とウィンドウサイズ
**目標**: 受信確認とフロー制御の基礎

**学習内容**:
- ACK番号の意味と計算
- 受信ウィンドウの概念
- 累積ACKと選択的ACK

**実装内容**:
- ACK生成・送信ロジック
- 受信ウィンドウ管理
- 未確認データ追跡
- ウィンドウサイズ計算

**RFC参照**: RFC 793 - Section 3.7 (Data Communication)

**成果物**:
- ACK処理システム
- ウィンドウサイズ管理
- 未ACKデータ追跡

**テスト**:
- ACK送受信テスト
- ウィンドウサイズ変動テスト
- データ受信順序テスト

---

## Phase 3: 信頼性確保編

### Step 7: タイムアウトと再送制御
**目標**: データ損失に対する対処機能

**学習内容**:
- RTO（Retransmission Timeout）
- 再送タイマーの管理
- 指数バックオフ

**実装内容**:
- 再送タイマー実装
- RTO計算アルゴリズム
- 再送キュー管理
- タイムアウト処理

**RFC参照**: RFC 6298 (Computing TCP's Retransmission Timer)

**成果物**:
- 再送制御システム
- タイマー管理機能
- RTO計算実装

**テスト**:
- パケット損失シミュレーション
- 再送タイミング検証
- RTO計算テスト

---

### Step 8: 順序制御と重複検出
**目標**: パケットの順序保証と重複排除

**学習内容**:
- アウトオブオーダー検出
- 重複パケット検出
- データ再組み立て

**実装内容**:
- 受信順序管理
- 重複検出ロジック
- データ再組み立て機能
- ギャップ検出

**RFC参照**: RFC 793 - Section 3.7 (Data Communication)

**成果物**:
- 順序制御システム
- 重複排除機能
- データ整合性保証

**テスト**:
- 順序入れ替えテスト
- 重複パケットテスト
- データ整合性検証

---

### Step 9: フロー制御の実装
**目標**: 受信者のバッファ保護機能

**学習内容**:
- スライディングウィンドウ
- ウィンドウサイズ調整
- バックプレッシャー

**実装内容**:
- 送信ウィンドウ管理
- ウィンドウ更新処理
- フロー制御アルゴリズム
- バッファ溢れ防止

**RFC参照**: RFC 793 - Section 3.7 (Data Communication)

**成果物**:
- フロー制御システム
- ウィンドウ管理機能
- バッファ保護機能

**テスト**:
- ウィンドウサイズ変動テスト
- バッファ満杯テスト
- スループット測定

---

## Phase 4: 高度な制御編

### Step 10: 輻輳制御（Slow Start、Congestion Avoidance）
**目標**: ネットワーク輻輳への対応

**学習内容**:
- 輻輳ウィンドウ（cwnd）
- Slow Startアルゴリズム
- Congestion Avoidanceアルゴリズム
- ssthresh（Slow Start Threshold）

**実装内容**:
- 輻輳ウィンドウ管理
- Slow Start実装
- Congestion Avoidance実装
- ssthresh管理

**RFC参照**: RFC 5681 - Section 3 (Slow Start and Congestion Avoidance)

**成果物**:
- 輻輳制御システム
- cwnd管理機能
- アルゴリズム切り替え

**テスト**:
- 輻輳シミュレーション
- cwnd変化測定
- スループット最適化検証

---

### Step 11: 高速再送とFast Recovery
**目標**: 効率的な損失回復機能

**学習内容**:
- 高速再送アルゴリズム
- Fast Recoveryアルゴリズム
- 重複ACKの活用

**実装内容**:
- 重複ACK検出
- 高速再送ロジック
- Fast Recovery実装
- 効率的な回復処理

**RFC参照**: RFC 5681 - Section 4 (Fast Retransmit/Fast Recovery)

**成果物**:
- 高速再送システム
- Fast Recovery機能
- 効率的な損失回復

**テスト**:
- 選択的パケット損失テスト
- 回復時間測定
- スループット影響評価

---

### Step 12: 接続終了処理（4-way handshake）
**目標**: 適切な接続終了手順

**学習内容**:
- FINフラグの処理
- 4-way handshakeプロセス
- TIME_WAIT状態
- 適切なリソース解放

**実装内容**:
- FINパケット処理
- 接続終了状態管理
- TIME_WAIT実装
- リソースクリーンアップ

**RFC参照**: RFC 793 - Section 3.5 (Closing a Connection)

**成果物**:
- 接続終了システム
- 適切な状態管理
- リソース管理機能

**テスト**:
- 正常終了テスト
- 異常終了処理テスト
- リソースリーク検証

---

## 総合テスト

### 統合テストシナリオ
1. **基本通信テスト**: 完全なTCP通信の実行
2. **エラー処理テスト**: 各種エラー状況の処理
3. **性能テスト**: スループットと遅延の測定
4. **ストレステスト**: 高負荷下での動作確認
5. **相互運用テスト**: 標準TCPスタックとの通信

### 検証項目
- RFC準拠性
- 性能特性
- 安定性
- エラー処理
- リソース使用量